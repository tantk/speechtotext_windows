# Note: Do NOT use crt-static for cdylib builds (backends) as it causes linker errors
# [target.x86_64-pc-windows-msvc]
# rustflags = ["-C", "target-feature=+crt-static"]

[env]
# Fix for system date being 2026 - CMake thinks VS 18 2026 should exist
CMAKE_GENERATOR = "Visual Studio 17 2022"

# Use CMake 3.29 to avoid FindCUDA path escaping bug in CMake 3.31
CMAKE = "C:/dev/speechwindows/tools/cmake/bin/cmake.exe"

# Force correct Visual Studio 2022 toolchain (avoiding phantom VS 18)
VSINSTALLDIR = "C:/Program Files/Microsoft Visual Studio/2022/Community/"
VCToolsInstallDir = "C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.44.35207/"
VCToolsVersion = "14.44.35207"

# LLVM/Clang for bindgen (whisper-rs-sys)
LIBCLANG_PATH = "C:/Program Files/LLVM/bin"
BINDGEN_EXTRA_CLANG_ARGS = '-isystem "C:/Program Files/LLVM/lib/clang/21/include" -isystem "C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.44.35207/include" -isystem "C:/Program Files (x86)/Windows Kits/10/Include/10.0.26100.0/ucrt"'

# Override CUDA paths to use v13.0 instead of system v10.1
# Using 8.3 short paths to avoid CMake escape issues
CUDA_PATH = "C:/PROGRA~1/NVIDIA~2/CUDA/v13.0"
CUDA_TOOLKIT_ROOT_DIR = "C:/PROGRA~1/NVIDIA~2/CUDA/v13.0"
CMAKE_CUDA_COMPILER = "C:/PROGRA~1/NVIDIA~2/CUDA/v13.0/bin/nvcc.exe"

# cuDNN paths for ct2rs
CMAKE_INCLUDE_PATH = "C:/PROGRA~1/NVIDIA/CUDNN/v9.18/include/13.1"
CMAKE_LIBRARY_PATH = "C:/PROGRA~1/NVIDIA/CUDNN/v9.18/lib/13.1/x64"

# CUDA architecture for whisper-ct2 (89 = RTX 40xx series)
# Using specific arch avoids command-line length issues on Windows
CUDA_ARCH_LIST = "89"
